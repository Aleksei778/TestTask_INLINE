# Тестовое задание ИНЛАЙН

Проект представляет собой систему для загрузки и поиска записей блога и комментариев из JSONPlaceholder API.

## Функциональность

1. Схема базы данных для хранения записей и комментариев
2. PHP скрипт для загрузки данных из API и сохранения их в БД
3. Веб-интерфейс для поиска записей по тексту комментариев

## Структура проекта

```
TestTask-INLINE/
├── database.sql              # SQL-скрипт для создания структуры БД
├── docker-compose.yml        # Конфигурация Docker Compose
├── Dockerfile                # Конфигурация PHP-контейнера
├── init-app.sh               # Скрипт инициализации приложения
├── public/                   # Директория с PHP-файлами
│   ├── index.php             # Веб-интерфейс для поиска записей
│   ├── fill_database.php     # Скрипт для заполнения БД
│   ├── pdo.php               # Настройки подключения к БД
│   └── styles.css            # Стили CSS для веб-интерфейса
├── README.md                 # Этот файл
└── wait-for-sql.sh           # Скрипт ожидания готовности БД
```

## Установка и запуск

### 1. Клонирование репозитория

```bash
git clone https://github.com/Aleksei778/TestTask_INLINE
cd TestTask_INLINE
```

### 2. Запуск с использованием Docker

```bash
docker-compose up -d
```

При первом запуске контейнеры будут созданы, база данных будет инициализирована, и данные будут загружены автоматически.

После запуска приложение будет доступно по адресу: http://localhost:8080

### 3. Проверка загруженных данных

```bash
docker-compose exec db mysql -u blog_user -p"blog_password" -e "SELECT COUNT(*) FROM blog_db.posts; SELECT COUNT(*) FROM blog_db.comments;"
```

## Использование

1. После загрузки данных вы увидите сообщение: "Загружено X записей и Y комментариев"
2. Для поиска записей по тексту комментария перейдите в веб-интерфейс и введите текст для поиска (минимум 3 символа)
3. Система выведет все записи, в комментариях к которым содержится указанный текст

## Примеры поисковых запросов

- "laudanti" - найдет комментарии, содержащие эту строку
- "odio" - распространенное слово в комментариях
- "error" - поиск по ошибкам

## Структура базы данных

### Таблица `posts`

Содержит записи (посты) из JSONPlaceholder.

| Поле      | Тип          | Описание                      |
|-----------|--------------|-------------------------------|
| id        | INT          | ID записи (первичный ключ)    |
| userId    | INT          | ID пользователя-автора        |
| title     | VARCHAR(255) | Заголовок записи              |
| body      | TEXT         | Содержание записи             |
| created_at| TIMESTAMP    | Дата и время создания         |

### Таблица `comments`

Содержит комментарии к записям из JSONPlaceholder.

| Поле      | Тип          | Описание                      |
|-----------|--------------|-------------------------------|
| id        | INT          | ID комментария (первичный ключ)|
| postId    | INT          | ID записи (внешний ключ)      |
| name      | VARCHAR(255) | Имя автора комментария        |
| email     | VARCHAR(255) | Email автора комментария      |
| body      | TEXT         | Текст комментария             |
| created_at| TIMESTAMP    | Дата и время создания         |

## Устранение неполадок

### Проблема: База данных не заполняется

1. Проверьте логи контейнера PHP:
   ```bash
   docker-compose logs php
   ```

2. Убедитесь, что MySQL-контейнер запущен и доступен:
   ```bash
   docker-compose exec php mysql -h db -u blog_user -p"blog_password" -e "SELECT 1"
   ```

3. Проверьте подключение к внешнему API:
   ```bash
   docker-compose exec php curl -v https://jsonplaceholder.typicode.com/posts
   ```

### Проблема: Контейнеры не запускаются

1. Проверьте логи Docker:
   ```bash
   docker-compose logs
   ```

2. Убедитесь, что порты 8080 и 3306 не заняты другими приложениями.

## Технические детали

### Используемые технологии

- PHP 8.2
- MySQL 8.0
- Apache
- Docker & Docker Compose

### Процесс автоматической инициализации

1. Docker создает сеть и тома для постоянного хранения данных
2. Запускается MySQL-контейнер и инициализируется база данных
3. Запускается PHP-контейнер, который ожидает готовности MySQL
4. После готовности MySQL запускается скрипт заполнения базы данных
5. Запускается Apache для обслуживания веб-запросов

## Ручное заполнение базы данных

Если вам нужно повторно заполнить базу данных:

```bash
docker-compose exec php php /var/www/html/fill_database.php
```

## Доступ к базе данных

```bash
docker-compose exec db mysql -u blog_user -p"blog_password" blog_db
```

## Если вы - противник Docker :]
- Можно использовать встроенный PHP-сервер: 
```bash
php -S localhost:8000
```
- Можно использовать ПО по типу XAMPP или WampServer (Windows), MAMP (MacOS)

## Лицензия

[MIT](https://opensource.org/licenses/MIT)
